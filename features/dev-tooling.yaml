# Feature: Developer Tooling
# CI enforcement scripts and workflow automation

feature: dev-tooling
planning_mode: autonomous  # Utility scripts, well-understood

# === PRD SECTION (What/Why) ===
problem: |
  Development workflow needs automation for consistency and CI enforcement.
  Without developer tooling:
  - Manual verification of doc-code coupling
  - No enforcement of claim system for coordination
  - Plan status and tests not tracked automatically
  - Mock usage and test coverage not enforced

  Developer tooling provides scripts for CI enforcement, plan management,
  and workflow automation.

out_of_scope:
  - "Feature spec validation (handled by meta-process-tooling)"
  - "Locked sections enforcement (handled by meta-process-tooling)"
  - "Feature coverage checking (handled by meta-process-tooling)"
  - "IDE integration or editor plugins"

# === ACCEPTANCE CRITERIA ===
acceptance_criteria:
  - id: AC-1
    scenario: "Doc-coupling check detects violations"
    category: happy_path
    given:
      - "Source file has changed"
      - "Coupled documentation not updated"
    when: "check_doc_coupling.py runs"
    then:
      - "Violation is reported"
      - "Exit code is non-zero"
      - "Suggests which docs to update"
    locked: true

  - id: AC-2
    scenario: "Claim system prevents duplicate work"
    category: happy_path
    given:
      - "Work item is already claimed by CC-1"
    when: "CC-2 tries to claim same work"
    then:
      - "Overlap is detected"
      - "Warning or block is issued"
      - "Existing claim information shown"
    locked: true

  - id: AC-3
    scenario: "Plan completion requires verification"
    category: happy_path
    given:
      - "Plan has required tests defined"
    when: "complete_plan.py runs"
    then:
      - "Tests are executed"
      - "Verification evidence is recorded"
      - "Plan status is updated"
    locked: true

  - id: AC-4
    scenario: "Mock usage check enforces policy"
    category: error_case
    given:
      - "Test file has mock without justification"
    when: "check_mock_usage.py --strict runs"
    then:
      - "Unjustified mock is flagged"
      - "Exit code is non-zero"
      - "File and line number reported"
    locked: true

  - id: AC-5
    scenario: "Plan blockers check finds stale dependencies"
    category: edge_case
    given:
      - "Plan A is blocked by Plan B"
      - "Plan B is now marked Complete"
    when: "check_plan_blockers.py runs"
    then:
      - "Stale blocker is detected"
      - "Plan A can be unblocked"
      - "Report shows which plans affected"
    locked: true

  - id: AC-6
    scenario: "Governance sync maintains ADR headers"
    category: happy_path
    given:
      - "Source file is governed by ADR-0001"
      - "Governance header is missing or outdated"
    when: "sync_governance.py --apply runs"
    then:
      - "Header is added/updated"
      - "ADR references are correct"
      - "File modification is clean"
    locked: true

# === IMPLEMENTATION SECTION ===
adrs: []  # Developer tooling predates ADR system

code:
  - scripts/dev_scripts/critique_specs.py
  - scripts/dev_scripts/gemini_chat.py
  - scripts/dev_scripts/summarize_specs.py
  - scripts/meta_status.py
  - scripts/safe_worktree_remove.py
  - scripts/check_claims.py
  - scripts/check_doc_coupling.py
  - scripts/merge_pr.py
  - scripts/cleanup_branches.py
  - scripts/check_mock_usage.py
  - scripts/check_mock_tests.py
  - scripts/check_new_code_tests.py
  - scripts/check_plan_blockers.py
  - scripts/check_plan_completion.py
  - scripts/check_plan_overlap.py
  - scripts/check_plan_tests.py
  - scripts/complete_plan.py
  - scripts/concat_for_review.py
  - scripts/plan_progress.py
  - scripts/sync_governance.py
  - scripts/sync_plan_status.py
  - scripts/validate_plan.py
  - scripts/validate_plan_completion.py
  - scripts/view_log.py

tests:
  - tests/unit/test_check_new_code_tests.py
  - tests/unit/test_check_plan_blockers.py
  - tests/unit/test_meta_status.py
  - tests/unit/test_merge_pr.py
  - tests/unit/test_safe_worktree_remove.py

docs:
  - docs/meta/claim-system.md
  - docs/meta/adr-governance.md
