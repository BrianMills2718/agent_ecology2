# =============================================================================
# AGENT ECOLOGY - CONFIG SCHEMA
# =============================================================================
# This defines the structure. See config.yaml for actual values.
# No numbers should appear in code - only here.
# =============================================================================

# -----------------------------------------------------------------------------
# RESOURCES
# All map to real physical/financial scarcity
# -----------------------------------------------------------------------------
resources:
  # Stock resources: finite pool, don't refresh, distributed initially
  stock:
    llm_budget:
      total: <number>           # Total $ for API calls (user's budget)
      unit: dollars
      distribution: equal       # How to split among agents: equal | weighted | custom
    disk:
      total: <number>           # Total bytes available
      unit: bytes
      distribution: equal

  # Flow resources: rate-limited, refresh per tick
  flow:
    compute:                    # LLM token budget (stored as "llm_tokens" in ledger)
      per_tick: <number>        # Token-units available per tick (~1K tokens each)
      unit: token_units
      distribution: equal       # Quota per agent
    bandwidth:
      per_tick: <number>        # Bytes of network I/O per tick
      unit: bytes
      distribution: equal

# -----------------------------------------------------------------------------
# SCRIP
# Economic currency - NOT a resource, just medium of exchange
# -----------------------------------------------------------------------------
scrip:
  starting_amount: <number>     # Each agent starts with this much
  # Note: scrip has no "total" - it's created via mint and destroyed via fees

# -----------------------------------------------------------------------------
# COSTS
# Token costs for thinking (real physical costs)
# Actions themselves are free. Real costs come from:
# - LLM tokens (thinking) - costs from your budget
# - Disk usage (writing) - costs from your disk quota
# - Genesis method costs (configurable per-method below)
# -----------------------------------------------------------------------------
costs:
  per_1k_input_tokens: <number>   # Compute cost per 1K input tokens
  per_1k_output_tokens: <number>  # Compute cost per 1K output tokens

# -----------------------------------------------------------------------------
# GENESIS ARTIFACTS
# System-provided services - fully configurable
# Each artifact can be enabled/disabled and has configurable methods
# -----------------------------------------------------------------------------
genesis:
  # Which artifacts to create (set to false to disable)
  artifacts:
    ledger:
      enabled: <boolean>        # Enable genesis_ledger
    mint:
      enabled: <boolean>        # Enable genesis_mint
    rights_registry:
      enabled: <boolean>        # Enable genesis_rights_registry
    event_log:
      enabled: <boolean>        # Enable genesis_event_log

  # Genesis Ledger - balance queries and transfers
  ledger:
    id: <string>                # Artifact ID (default: genesis_ledger)
    description: <string>       # Artifact description
    methods:
      balance:
        cost: <number>          # Scrip cost (0 = free)
        description: <string>
      all_balances:
        cost: <number>
        description: <string>
      transfer:
        cost: <number>          # Fee to transfer scrip
        description: <string>
      spawn_principal:
        cost: <number>          # Fee to spawn new principal
        description: <string>

  # Genesis Mint - auction-based scoring and minting
  mint:
    id: <string>
    description: <string>
    mint_ratio: <number>        # score / ratio = scrip minted

    # Auction configuration (Vickrey auction for scoring slots)
    auction:
      period: <number>          # Ticks between auctions
      bidding_window: <number>  # Duration of bidding phase (ticks)
      first_auction_tick: <number>  # Grace period before first auction
      slots_per_auction: <number>   # Winners per auction
      minimum_bid: <number>     # Floor bid amount
      tie_breaking: <string>    # "random" or "first_bid"
      show_bid_count: <boolean> # Show number of bids during window
      allow_bid_updates: <boolean>  # Can agents update their bid?
      refund_on_scoring_failure: <boolean>  # Refund if LLM scoring fails

    methods:
      status:
        cost: <number>          # Check auction status (phase, tick, bid count)
        description: <string>
      bid:
        cost: <number>          # Submit sealed bid during bidding window
        description: <string>
      check:
        cost: <number>          # Check scoring result for an artifact
        description: <string>

  # Genesis Rights Registry - quota management
  rights_registry:
    id: <string>
    description: <string>
    methods:
      check_quota:
        cost: <number>
        description: <string>
      all_quotas:
        cost: <number>
        description: <string>
      transfer_quota:
        cost: <number>          # Fee to transfer quota
        description: <string>

  # Genesis Event Log - passive observability
  event_log:
    id: <string>
    description: <string>
    max_per_read: <number>      # Cap events returned per read
    buffer_size: <number>       # Internal buffer size
    methods:
      read:
        cost: <number>
        description: <string>

  # Genesis Store - artifact discovery and registry
  store:
    id: <string>
    description: <string>
    methods:
      list:
        cost: <number>          # List artifacts with optional filter
        description: <string>
      get:
        cost: <number>          # Get single artifact details
        description: <string>
      search:
        cost: <number>          # Search by content match
        description: <string>
      list_by_type:
        cost: <number>          # Filter by artifact type
        description: <string>
      list_by_owner:
        cost: <number>          # Filter by owner
        description: <string>
      list_agents:
        cost: <number>          # List agent artifacts only
        description: <string>
      list_principals:
        cost: <number>          # List principals (has_standing=True)
        description: <string>
      count:
        cost: <number>          # Count artifacts matching filter
        description: <string>
      get_interface:             # Plan #114: Interface discovery
        cost: <number>          # Get interface schema for an artifact
        description: <string>

# -----------------------------------------------------------------------------
# RATE LIMITING
# Rolling window rate limiting (time-based, not tick-based)
# -----------------------------------------------------------------------------
rate_limiting:
  enabled: <boolean>              # Enable rate limiting (default: false)
  window_seconds: <number>        # Rolling window duration (default: 60.0)
  resources:                      # Per-resource limits
    llm_tokens:
      max_per_window: <number>    # Max LLM tokens per window
    llm_calls:
      max_per_window: <number>    # Max LLM API calls per window
    disk_writes:
      max_per_window: <number>    # Max disk write operations per window
    bandwidth_bytes:
      max_per_window: <number>    # Max bytes transferred per window
    cpu_seconds:
      max_per_window: <number>    # Max CPU seconds per window (Plan #53)
    memory_bytes:
      max_per_window: <number>    # Max memory bytes per window (Plan #53)

# -----------------------------------------------------------------------------
# EXECUTION
# Agent execution model settings
# -----------------------------------------------------------------------------
execution:
  use_autonomous_loops: <boolean>  # Enable continuous autonomous loops (default: false)
  use_worker_pool: <boolean>       # Use worker pool for process-isolated turns (default: false)
  worker_pool:
    num_workers: <number>          # Number of worker threads (default: 4)
    state_db_path: <string>        # Path to SQLite state database (default: "agent_state.db")
  agent_loop:
    min_loop_delay: <number>       # Minimum seconds between actions (default: 0.1)
    max_loop_delay: <number>       # Maximum backoff delay on errors (default: 10.0)
    resource_check_interval: <number>  # Seconds between resource checks when paused (default: 1.0)
    max_consecutive_errors: <number>   # Errors before forced pause (default: 5)
    resources_to_check:            # Resource types to check before each iteration
      - <string>                   # e.g., "llm_calls", "disk_writes", "bandwidth_bytes"
    resource_exhaustion_policy: <string>  # Policy when resources exhausted: "skip" or "block" (default: "skip")
                                          # - "skip": Skip action, sleep briefly, try again next iteration
                                          # - "block": Block until capacity available using wait_for_capacity

# -----------------------------------------------------------------------------
# TIMEOUTS
# Consolidated timeout values for all components
# -----------------------------------------------------------------------------
timeouts:
  agent_loop_stop: <number>     # AgentLoop stop timeout (seconds, default: 5.0)
  loop_manager_stop: <number>   # AgentLoopManager stop_all timeout (seconds, default: 10.0)
  simulation_shutdown: <number> # SimulationRunner shutdown timeout (seconds, default: 5.0)
  mcp_server: <number>          # MCP server operations timeout (seconds, default: 5.0)
  state_store_lock: <number>    # SQLite lock timeout (seconds, default: 30.0)
  state_store_retry_max: <int>       # Max retry attempts for SQLite lock errors (default: 10)
  state_store_retry_base: <number>   # Base backoff delay seconds (default: 0.05)
  state_store_retry_max_delay: <number>  # Max backoff delay seconds (default: 2.0)
  dashboard_server: <number>    # Dashboard server operations timeout (seconds, default: 30.0)

# -----------------------------------------------------------------------------
# EXECUTOR
# Code execution settings
# -----------------------------------------------------------------------------
executor:
  timeout_seconds: <number>     # Max time for agent code to run
  max_invoke_depth: <number>    # Maximum artifact invocation nesting depth (default: 5)
  max_contract_depth: <number>  # Maximum contract permission check depth (default: 10, Plan #100)
  interface_validation: <string>  # 'none', 'warn', or 'strict' - validate invoke args against interface schema (Plan #86)
  allowed_imports:              # Whitelist of importable modules
    - math
    - json
    - random
    - datetime

# -----------------------------------------------------------------------------
# VALIDATION
# Input validation limits to prevent DoS attacks
# -----------------------------------------------------------------------------
validation:
  max_artifact_id_length: <number>  # Max chars for artifact IDs (default: 128)
  max_method_name_length: <number>  # Max chars for method names (default: 64)

# -----------------------------------------------------------------------------
# MINT SCORER
# External LLM scoring settings
# -----------------------------------------------------------------------------
mint_scorer:
  model: <string>               # LLM model for scoring
  timeout: <number>             # Seconds
  max_content_length: <number>  # Truncate content beyond this
  score_bounds:                 # Score clamping bounds
    min: <number>               # Minimum score (default: 0)
    max: <number>               # Maximum score (default: 100)
  thread_pool_workers: <number> # Thread pool size for scoring (default: 1)

# -----------------------------------------------------------------------------
# LLM
# Agent LLM settings
# -----------------------------------------------------------------------------
llm:
  default_model: <string>       # Default model for new agents
  timeout: <number>
  rate_limit_delay: <number>    # Seconds between calls
  allowed_models:               # Models agents are permitted to use
    - <string>                  # Future: agents can switch within this list

# -----------------------------------------------------------------------------
# LOGGING
# -----------------------------------------------------------------------------
logging:
  output_file: <string>
  logs_dir: <string>            # Per-run logs directory (e.g., logs/run_20260115_120000/)
  log_dir: <string>
  default_recent: <number>      # Default N for "recent events"
  truncation:                   # Log message truncation limits
    content: <number>           # Artifact content in logs (default: 100)
    code: <number>              # Code snippets in logs (default: 100)
    errors: <number>            # Error messages (default: 100)
    detailed: <number>          # Detailed logs (default: 500)
    result_data: <number>       # ActionResult.data in logs (default: 1000, Plan #80)

# -----------------------------------------------------------------------------
# MONITORING
# Ecosystem health monitoring settings
# -----------------------------------------------------------------------------
monitoring:
  audit_thresholds:             # Audit alert thresholds
    gini:
      warning: <number>         # Warning threshold (default: 0.7)
      critical: <number>        # Critical threshold (default: 0.9)
    frozen_ratio:
      warning: <number>         # Warning threshold (default: 0.2)
      critical: <number>        # Critical threshold (default: 0.5)
    active_ratio:
      warning: <number>         # Warning threshold (default: 0.3)
      critical: <number>        # Critical threshold (default: 0.1)
    burn_rate:
      warning: <number>         # Warning threshold (default: 0.1)
      critical: <number>        # Critical threshold (default: 0.25)
    scrip_velocity_low:
      warning: <number>         # Warning threshold (default: 0.001)
  health_scoring:               # Health score calculation parameters
    warning_penalty: <number>   # Penalty per warning (default: 0.1)
    critical_penalty: <number>  # Penalty per critical (default: 0.2)
    trend_threshold: <number>   # Threshold for trend detection (default: 0.1)
    trend_history_ticks: <number>  # Ticks of history to analyze (default: 10)
  active_agent_threshold_ticks: <number>  # Ticks of inactivity before agent considered inactive (default: 5)

# -----------------------------------------------------------------------------
# WORLD
# Simulation settings
# -----------------------------------------------------------------------------
world:
  max_ticks: <number>

# -----------------------------------------------------------------------------
# BUDGET
# API spending limits (global and per-agent)
# -----------------------------------------------------------------------------
budget:
  max_api_cost: <number>        # $ limit for global simulation (0 = unlimited)
  per_agent_budget: <number>    # $ limit per agent (Plan #12, 0 = no enforcement)
  checkpoint_file: <string>     # Where to save state on pause

# -----------------------------------------------------------------------------
# LIBRARIES
# Package installation configuration for agents
# -----------------------------------------------------------------------------
libraries:
  # Genesis libraries: Pre-installed, don't count against disk quota
  # These are baked into the Docker image as cold-start conveniences
  genesis:
    - <string>                  # e.g., "numpy", "pandas", "requests"

  # Blocked packages: Security risks (sandbox escape, etc.)
  blocked:
    - <string>                  # e.g., "docker", "debugpy"

# -----------------------------------------------------------------------------
# DASHBOARD
# HTML visibility interface for monitoring simulation
# -----------------------------------------------------------------------------
dashboard:
  enabled: <boolean>            # Enable dashboard server
  host: <string>                # Host to bind (0.0.0.0 for all interfaces)
  port: <number>                # Port number (default: 8080)
  static_dir: <string>          # Path to static files directory
  jsonl_file: <string>          # Path to JSONL event log to monitor
  websocket_path: <string>      # WebSocket endpoint path
  cors_origins:                 # Allowed CORS origins
    - <string>
  max_events_cache: <number>    # Max events to cache in memory
  debounce_delay_ms: <number>   # File watcher debounce delay (default: 100)
  poll_interval: <number>       # Polling interval in seconds (default: 0.5)

# -----------------------------------------------------------------------------
# ID GENERATION
# Settings for artifact ID generation
# -----------------------------------------------------------------------------
id_generation:
  uuid_hex_length: <number>     # Characters from UUID hex for IDs (default: 8)
