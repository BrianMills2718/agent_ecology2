<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Ecology Dashboard</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/vis-network@9.1.6/standalone/umd/vis-network.min.js"></script>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <h1>Agent Ecology Dashboard</h1>
            <div class="header-controls">
                <div class="simulation-controls" id="sim-controls">
                    <button id="btn-pause" class="control-btn pause" title="Pause Simulation">
                        <span class="btn-icon">||</span>
                        <span class="btn-text">Pause</span>
                    </button>
                    <button id="btn-resume" class="control-btn resume hidden" title="Resume Simulation">
                        <span class="btn-icon">></span>
                        <span class="btn-text">Resume</span>
                    </button>
                </div>
                <div class="connection-status">
                    <span id="ws-status" class="status-indicator disconnected"></span>
                    <span id="ws-status-text">Disconnected</span>
                </div>
            </div>
        </header>

        <!-- Progress Bar -->
        <section class="progress-section">
            <div class="progress-container">
                <div class="progress-info">
                    <span id="tick-display">Tick: 0 / 100</span>
                    <span id="status-display" class="status-badge">Initializing</span>
                </div>
                <div class="progress-bar">
                    <div id="tick-progress" class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-info">
                    <span id="budget-display">API Budget: $0.00 / $1.00</span>
                    <span id="tps-display">0 ticks/sec</span>
                </div>
                <div class="progress-bar budget">
                    <div id="budget-progress" class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
        </section>

        <!-- Main Grid -->
        <main class="main-grid">
            <!-- Left Column: Agents and Artifacts -->
            <div class="left-column">
                <!-- Agents Panel -->
                <section class="panel agents-panel">
                    <div class="panel-header">
                        <h2>Agents</h2>
                        <span id="agent-count" class="count-badge">0</span>
                    </div>
                    <div class="panel-content">
                        <table class="data-table" id="agents-table">
                            <thead>
                                <tr>
                                    <th title="Agent identifier">ID</th>
                                    <th title="Economic currency - used to pay for artifacts and trade">Scrip</th>
                                    <th title="Compute usage % this tick (refreshes each tick)">Compute</th>
                                    <th title="Disk storage usage % (permanent, doesn't refresh)">Disk</th>
                                    <th title="Agent status: active, low_resources, or frozen">Status</th>
                                    <th title="Total actions taken by this agent">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="agents-tbody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- Artifacts Panel -->
                <section class="panel artifacts-panel">
                    <div class="panel-header">
                        <h2>Artifacts</h2>
                        <span id="artifact-count" class="count-badge">0</span>
                    </div>
                    <div class="panel-controls">
                        <input type="text" id="artifact-search" placeholder="Search artifacts..." class="search-input">
                        <select id="artifact-filter" class="filter-select">
                            <option value="">All Types</option>
                            <option value="tool">Tools</option>
                            <option value="data">Data</option>
                            <option value="code">Code</option>
                        </select>
                    </div>
                    <div class="panel-content scrollable">
                        <table class="data-table" id="artifacts-table">
                            <thead>
                                <tr>
                                    <th title="Unique artifact identifier">ID</th>
                                    <th title="Artifact type (executable, data, etc.)">Type</th>
                                    <th title="Current owner (agent or contract)">Owner</th>
                                    <th title="Base scrip cost to invoke (* = executable, may have dynamic fees)">Price</th>
                                    <th title="Executable: Can be invoked by agents">Exec</th>
                                    <th title="Mint score: Quality rating from external LLM (0-10)">Mint</th>
                                </tr>
                            </thead>
                            <tbody id="artifacts-tbody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>

            <!-- Center Column: Network Graph and Activity Feed -->
            <div class="center-column">
                <!-- Network Graph Panel -->
                <section class="panel network-panel">
                    <div class="panel-header">
                        <h2>Agent Interactions</h2>
                        <div class="network-controls">
                            <input type="range" id="tick-slider" min="0" max="100" value="100" class="tick-slider">
                            <span id="tick-slider-value">Tick: All</span>
                        </div>
                    </div>
                    <div class="panel-content network-container" id="network-container">
                        <!-- vis.js network renders here -->
                    </div>
                    <div class="network-legend">
                        <span class="legend-item"><span class="legend-dot scrip-transfer"></span> Scrip Transfer</span>
                        <span class="legend-item"><span class="legend-dot escrow-trade"></span> Trade</span>
                        <span class="legend-item"><span class="legend-dot ownership-transfer"></span> Ownership</span>
                        <span class="legend-item"><span class="legend-dot artifact-invoke"></span> Invoke</span>
                    </div>
                </section>

                <!-- Temporal Network Panel (Plan #107) -->
                <section class="panel temporal-network-panel collapsed">
                    <div class="panel-header" id="temporal-network-toggle">
                        <h2>Artifact Network</h2>
                        <span class="collapse-icon">+</span>
                    </div>
                    <div class="panel-content" id="temporal-network-content">
                        <div class="temporal-network-container" id="temporal-network-container">
                            <!-- vis.js temporal network renders here -->
                        </div>
                        <div class="temporal-network-footer">
                            <div class="temporal-network-stats" id="temporal-network-stats">
                                <!-- Stats populated by JS -->
                            </div>
                            <div class="temporal-network-legend" id="temporal-network-legend">
                                <!-- Legend populated by JS -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Artifact Dependency Graph Panel -->
                <section class="panel dependency-panel collapsed">
                    <div class="panel-header" id="dependency-toggle">
                        <h2>Artifact Dependencies</h2>
                        <span class="collapse-icon">+</span>
                    </div>
                    <div class="panel-content" id="dependency-content">
                        <div class="dependency-controls">
                            <select id="dependency-filter" class="filter-select">
                                <option value="">All Artifacts</option>
                                <option value="genesis">Genesis Only</option>
                                <option value="agent-created">Agent Created</option>
                                <option value="with-deps">With Dependencies</option>
                            </select>
                            <div id="dependency-metrics" class="dependency-metrics">
                                <!-- Metrics populated by JS -->
                            </div>
                        </div>
                        <div class="dependency-graph-container" id="dependency-graph-container">
                            <!-- vis.js dependency graph renders here -->
                        </div>
                        <div class="dependency-legend">
                            <span class="legend-item"><span class="legend-dot genesis"></span> Genesis</span>
                            <span class="legend-item"><span class="legend-dot contract"></span> Contract</span>
                            <span class="legend-item"><span class="legend-dot executable"></span> Executable</span>
                            <span class="legend-item"><span class="legend-dot data"></span> Data</span>
                        </div>
                    </div>
                </section>

                <!-- Activity Feed Panel -->
                <section class="panel activity-panel">
                    <div class="panel-header">
                        <h2>Activity Feed</h2>
                        <div class="activity-controls">
                            <select id="activity-type-filter" class="filter-select">
                                <option value="">All Activity</option>
                                <option value="artifact_created,artifact_updated">Artifacts</option>
                                <option value="scrip_transfer">Transfers</option>
                                <option value="escrow_listed,escrow_purchased,escrow_cancelled">Trades</option>
                                <option value="ownership_transfer">Ownership</option>
                                <option value="mint_result">Mints</option>
                            </select>
                        </div>
                    </div>
                    <div class="panel-content scrollable" id="activity-content">
                        <!-- Populated by JS -->
                    </div>
                </section>

                <!-- Agent Thinking Panel -->
                <section class="panel thinking-panel" id="thinking-panel">
                    <div class="panel-header">
                        <h2>Agent Thinking</h2>
                        <div class="thinking-controls">
                            <select id="thinking-agent-filter" class="filter-select">
                                <option value="">All Agents</option>
                                <!-- Populated by JS -->
                            </select>
                        </div>
                    </div>
                    <div class="panel-content scrollable" id="thinking-list">
                        <!-- Populated by JS -->
                    </div>
                </section>

                <!-- Charts Panel (collapsed) -->
                <section class="panel charts-panel collapsed">
                    <div class="panel-header" id="charts-toggle">
                        <h2>Resource Charts</h2>
                        <span class="collapse-icon">+</span>
                    </div>
                    <div class="panel-content chart-container" id="charts-content">
                        <div class="chart-tabs">
                            <button class="tab-btn active" data-chart="compute">Compute</button>
                            <button class="tab-btn" data-chart="scrip">Scrip</button>
                        </div>
                        <canvas id="resource-chart"></canvas>
                    </div>
                </section>
            </div>

            <!-- Right Column: Genesis and Events -->
            <div class="right-column">
                <!-- Genesis Panel -->
                <section class="panel genesis-panel">
                    <div class="panel-header">
                        <h2>Genesis Activity</h2>
                    </div>
                    <div class="panel-content">
                        <div class="genesis-tabs">
                            <button class="genesis-tab active" data-tab="mint">Mint</button>
                            <button class="genesis-tab" data-tab="escrow">Escrow</button>
                            <button class="genesis-tab" data-tab="ledger">Ledger</button>
                        </div>
                        <div class="genesis-content" id="genesis-content">
                            <!-- Mint Tab -->
                            <div class="genesis-tab-content active" id="genesis-mint">
                                <div class="genesis-stat">
                                    <span class="stat-label">Pending:</span>
                                    <span id="mint-pending" class="stat-value">0</span>
                                </div>
                                <div class="genesis-stat">
                                    <span class="stat-label">Total Minted:</span>
                                    <span id="mint-minted" class="stat-value">0</span>
                                </div>
                                <div class="genesis-list" id="mint-scores">
                                    <!-- Recent scores -->
                                </div>
                            </div>
                            <!-- Escrow Tab -->
                            <div class="genesis-tab-content" id="genesis-escrow">
                                <div class="genesis-stat">
                                    <span class="stat-label">Active Listings:</span>
                                    <span id="escrow-active" class="stat-value">0</span>
                                </div>
                                <div class="genesis-list" id="escrow-listings">
                                    <!-- Active listings -->
                                </div>
                            </div>
                            <!-- Ledger Tab -->
                            <div class="genesis-tab-content" id="genesis-ledger">
                                <div class="genesis-stat">
                                    <span class="stat-label">Recent Transfers:</span>
                                    <span id="ledger-transfer-count" class="stat-value">0</span>
                                </div>
                                <div class="genesis-list" id="ledger-transfers">
                                    <!-- Recent transfers -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Events Panel -->
                <section class="panel events-panel">
                    <div class="panel-header">
                        <h2>Event Stream</h2>
                        <div class="event-controls">
                            <button id="events-pause" class="icon-btn" title="Pause">||</button>
                            <button id="events-clear" class="icon-btn" title="Clear">X</button>
                        </div>
                    </div>
                    <div class="panel-controls">
                        <select id="event-type-filter" class="filter-select" multiple>
                            <option value="tick">tick</option>
                            <option value="thinking">thinking</option>
                            <option value="action">action</option>
                            <option value="mint">mint</option>
                            <option value="intent_rejected">rejected</option>
                        </select>
                    </div>
                    <div class="panel-content scrollable" id="events-content">
                        <!-- Populated by JS -->
                    </div>
                </section>
            </div>
        </main>

        <!-- Agent Detail Modal -->
        <div id="agent-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modal-agent-id">Agent Details</h2>
                    <button class="modal-close" id="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <h3>Balances</h3>
                        <div class="modal-stats" id="modal-balances">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="modal-section">
                        <h3>Artifacts Owned</h3>
                        <div class="modal-list" id="modal-artifacts">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="modal-section">
                        <h3>Recent Actions</h3>
                        <div class="modal-list scrollable" id="modal-actions">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="modal-section">
                        <h3>Recent Thinking</h3>
                        <div class="modal-list scrollable" id="modal-thinking">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="modal-section">
                        <h3>Configuration</h3>
                        <div class="agent-config-content" id="modal-config">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Artifact Detail Modal -->
        <div id="artifact-modal" class="modal hidden">
            <div class="modal-content modal-wide">
                <div class="modal-header">
                    <h2 id="artifact-modal-title">Artifact Details</h2>
                    <button class="modal-close" id="artifact-modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="modal-section">
                        <h3>Info</h3>
                        <div class="modal-stats" id="artifact-modal-info">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                    <div class="modal-section">
                        <h3>Content</h3>
                        <pre class="code-block" id="artifact-modal-content">
                            <!-- Populated by JS -->
                        </pre>
                    </div>
                    <div class="modal-section">
                        <h3>Ownership History</h3>
                        <div class="modal-list" id="artifact-modal-ownership">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="/static/js/utils/api.js"></script>
    <script src="/static/js/websocket.js"></script>
    <script src="/static/js/panels/progress.js"></script>
    <script src="/static/js/panels/agents.js"></script>
    <script src="/static/js/panels/artifacts.js"></script>
    <script src="/static/js/panels/events.js"></script>
    <script src="/static/js/panels/charts.js"></script>
    <script src="/static/js/panels/genesis.js"></script>
    <script src="/static/js/panels/controls.js"></script>
    <script src="/static/js/panels/network.js"></script>
    <script src="/static/js/panels/dependency-graph.js"></script>
    <script src="/static/js/panels/activity.js"></script>
    <script src="/static/js/panels/thinking.js"></script>
    <script src="/static/js/panels/temporal-network.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>
