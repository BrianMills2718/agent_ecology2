# Doc-Code Coupling Map
#
# Defines which docs must be reviewed when source files change.
# CI will fail on strict couplings, warn on soft couplings.
#
# Format:
#   - sources: [glob patterns for source files]
#     docs: [paths to docs that should be updated]
#     description: what this coupling represents
#     soft: true  # Optional: warn instead of fail

couplings:
  # ===========================================================================
  # STRICT COUPLINGS (CI fails if violated)
  # ===========================================================================

  # Core execution model
  - sources:
      - "src/simulation/runner.py"
      - "src/world/world.py"
    docs:
      - "docs/architecture/current/execution_model.md"
    description: "Tick loop and two-phase execution"

  # Resource accounting
  - sources:
      - "src/world/ledger.py"
      - "src/world/simulation_engine.py"
    docs:
      - "docs/architecture/current/resources.md"
    description: "Flow/stock resources, scrip, budget tracking"

  # Genesis artifacts
  - sources:
      - "src/world/genesis.py"
    docs:
      - "docs/architecture/current/genesis_artifacts.md"
    description: "System services (ledger, oracle, escrow, etc.)"

  # Agent system
  - sources:
      - "src/agents/agent.py"
      - "src/agents/memory.py"
      - "src/agents/loader.py"
    docs:
      - "docs/architecture/current/agents.md"
    description: "Agent lifecycle, thinking, memory"

  # Artifacts and execution
  - sources:
      - "src/world/artifacts.py"
      - "src/world/executor.py"
      - "src/world/actions.py"
    docs:
      - "docs/architecture/current/artifacts_executor.md"
    description: "Artifact storage, policies, code execution"

  # Configuration
  - sources:
      - "src/config.py"
      - "src/config_schema.py"
    docs:
      - "docs/architecture/current/configuration.md"
    description: "Config loading and validation"

  # Supporting systems
  - sources:
      - "src/simulation/checkpoint.py"
      - "src/world/logger.py"
      - "src/dashboard/*.py"
    docs:
      - "docs/architecture/current/supporting_systems.md"
    description: "Checkpoint, logging, dashboard"

  # CI itself
  - sources:
      - ".github/workflows/ci.yml"
      - "scripts/check_doc_coupling.py"
      - "scripts/doc_coupling.yaml"
    docs:
      - "docs/architecture/current/ci.md"
    description: "CI pipeline"

  # ===========================================================================
  # GAP STATUS COUPLINGS (Strict - ensures gap index stays in sync)
  # ===========================================================================

  # Gap plans must sync with index
  - sources:
      - "docs/architecture/gaps/plans/*.md"
    docs:
      - "docs/architecture/gaps/CLAUDE.md"
    description: "Gap plan status change - update index in CLAUDE.md"

  # ===========================================================================
  # SOFT COUPLINGS (CI warns but doesn't fail)
  # ===========================================================================

  # When current/ docs change, consider if a gap was closed
  - sources:
      - "docs/architecture/current/*.md"
    docs:
      - "docs/architecture/gaps/CLAUDE.md"
    description: "Gap closure tracking - update gap status if gap closed"
    soft: true

  # When implementing rate tracker, update epic 1
  - sources:
      - "src/world/rate_tracker.py"
    docs:
      - "docs/architecture/gaps/CLAUDE.md"
    description: "Rate tracker implementation - update Epic 1 status"
    soft: true

  # When implementing agent loops, update epic 2
  - sources:
      - "src/simulation/agent_loop.py"
    docs:
      - "docs/architecture/gaps/CLAUDE.md"
    description: "Agent loop implementation - update Epic 2 status"
    soft: true

  # Terminology changes affect multiple docs
  - sources:
      - "src/world/ledger.py"
      - "src/config_schema.py"
    docs:
      - "docs/GLOSSARY.md"
    description: "Terminology - new terms or renamed concepts?"
    soft: true
